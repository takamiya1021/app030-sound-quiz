# app030: 音当てクイズ - 要件定義書

## 1. アプリ概要
ランダムに再生される音を聞いて、何の音かを当てるクイズアプリ。日常の音、楽器の音、動物の鳴き声等、様々なカテゴリーの音をゲーム感覚で学習できる。

## 2. 目的・課題

### 解決する課題
- 音感・聴力のトレーニング方法が限られている
- 楽器の音色の違いを学ぶ機会が少ない
- 子供の聴覚教育のツールが不足
- 音楽制作での音色選びに自信がない
- 日常の音に対する意識が低い

### 目的
- 音感・聴力のトレーニング
- 楽器や音色の特徴を学習
- 子供の聴覚教育支援
- ゲーム感覚で楽しく音を学ぶ

## 3. ターゲットユーザー
- 音楽初心者・学習者
- 子供（聴覚教育）
- 音楽制作者・DTM初心者
- 効果音を扱うクリエイター
- 音に対する感性を高めたい一般ユーザー

## 4. 機能要件

### 4.1 必須機能（MVP）
- **音声再生**
  - ランダムに選ばれた音を再生
  - 再生ボタン（繰り返し聞ける）
  - 音量調整

- **クイズ出題**
  - 4択問題形式
  - カテゴリー別出題（楽器/動物/日常音/自然音等）
  - 1セット10問

- **回答・採点**
  - 選択肢をクリックで回答
  - 即座に正誤判定
  - 正解音の再生
  - スコア表示（正解数/総問題数）

- **音源バンク**
  - 最低50音のプリセット音源
  - カテゴリー分類（5〜7カテゴリー）
  - 音源形式: MP3/WAV

### 4.2 拡張機能（優先度：中）
- **難易度設定**
  - 初級: 明確に異なる音（ピアノ/ドラム/猫/犬等）
  - 中級: 似た音（バイオリン/ビオラ、猫の鳴き声の種類等）
  - 上級: 微妙な違い（同じ楽器の異なる音域等）

- **学習モード**
  - 音源ライブラリの自由閲覧
  - カテゴリー別一覧表示
  - 音の説明文表示

- **進捗管理**
  - 正答率の記録
  - カテゴリー別正答率
  - 学習履歴

- **タイマー機能**
  - 1問あたりの制限時間
  - タイムアタックモード

### 4.3 将来的な拡張（優先度：低）
- 音声アップロード機能（自作問題作成）
- マルチプレイヤー対戦
- ランキング機能
- 音の波形表示（教育目的）

### 4.4 AI機能（Gemini API）
- **音声説明文の自動生成**
  - 各音の特徴を詳しく言葉で解説
  - 「この音はこういう特徴がある」という説明を生成
  - 音の由来・背景情報の提供
  - 複数言語対応（日本語/英語）

- **聞き分けアドバイス**
  - よく間違える音の組み合わせを分析
  - 「この音とこの音の違いはここに注目」というヒント生成
  - 聞き分けのコツ・ポイントを提案
  - 音感トレーニングのアドバイス

- **類似音の違いを言語化**
  - 似た音の微妙な違いを言葉で説明
  - 「バイオリンとビオラの違い」等を解説
  - 音色の特徴を具体的に表現
  - 初心者にも分かりやすい表現で説明

- **学習プラン提案**
  - ユーザーの正答率・苦手分野を分析
  - 効果的な学習順序を提案
  - 段階的な難易度調整
  - 個別最適化された練習プラン

- **問題自動生成**
  - 既存の音源から新しいクイズ問題を自動生成
  - カテゴリー・難易度を指定して問題作成
  - 選択肢の自動生成（紛らわしい選択肢の作成）

## 5. 非機能要件

### 5.1 パフォーマンス
- 音声再生の遅延 < 100ms
- スムーズな問題遷移
- 音源プリロードで待ち時間最小化

### 5.2 ユーザビリティ
- 直感的な再生ボタン
- 視認性の高いUI
- レスポンシブデザイン（スマホ・タブレット対応）

### 5.3 音質
- クリアで聞き取りやすい音質
- 音量の統一（音源ごとのばらつきを最小化）
- 背景ノイズの除去

## 6. 技術制約

### 6.1 環境要件
- モダンブラウザ対応（Web Audio API）
- レスポンシブデザイン（デスクトップ・タブレット・スマホ）
- オフライン動作可能（音源プリロード）

### 6.2 音声処理
- Web Audio API使用
- 音源形式: MP3（互換性）/WAV（高品質）
- 音量正規化処理

### 6.3 データ制約
- 音源ファイルサイズ: 1ファイル < 500KB
- 総音源サイズ: < 25MB（初期版）
- LocalStorageで進捗保存

### 6.4 AI API仕様
- **使用API**: Google Gemini API
  - モデル: gemini-2.0-flash-exp
  - エンドポイント: Google AI Studio API

- **APIキー管理**
  - 保存場所: LocalStorage
  - 保存形式: 平文（暗号化なし）
  - キー名: `gemini_api_key`
  - 設定UI: アプリ内設定画面で登録・変更可能

- **起動時チェック**
  - APIキー未登録時は設定画面を表示
  - APIキー検証（簡易的な接続テスト）
  - エラーハンドリング（APIキー無効時の対応）

- **AI機能の利用**
  - AI機能はオプション（APIキーなしでも基本機能は利用可能）
  - API呼び出しエラー時の適切なフィードバック
  - レート制限への対応

## 7. 成功基準

### 7.1 機能面
- ✅ 音声がスムーズに再生される
- ✅ クイズが正常に出題・回答できる
- ✅ 正誤判定とスコア表示が正確
- ✅ カテゴリー別学習ができる

### 7.2 UX面
- ✅ 初心者でも楽しく学習できる
- ✅ 音質が良く聞き取りやすい
- ✅ 達成感を感じられる

### 7.3 教育面
- ✅ 音の違いを聞き分けられるようになる
- ✅ 楽器や音の知識が深まる
- ✅ 継続的に学習したくなる

## 8. 制約事項・前提条件

### 8.1 制約事項
- 音源は著作権フリーまたは自作のみ使用
- 音声アップロード機能は未実装（Phase 1）
- リアルタイム対戦は未対応（Phase 1）

### 8.2 前提条件
- ユーザーは音声を聞ける環境（スピーカー/イヤホン）
- Web Audio API対応ブラウザ
- JavaScript有効環境

## 9. UI/UX要求

### 9.1 デザイン方向性
- 楽しく親しみやすいデザイン
- 視覚的フィードバック（正解時のアニメーション）
- 音楽アプリらしい音符・波形等のビジュアル要素

### 9.2 主要画面
1. **ホーム画面**
   - アプリ名・キャッチコピー
   - クイズ開始ボタン（カテゴリー選択/ランダム）
   - 学習モードボタン（音源ライブラリ）
   - 累計正答率・学習日数

2. **カテゴリー選択画面**
   - カテゴリー一覧（楽器/動物/日常音/自然音等）
   - 各カテゴリーのアイコン・問題数・正答率
   - 難易度選択（初級/中級/上級）

3. **クイズ画面**
   - 上部: 問題番号（1/10）、カテゴリー名
   - 中央: 音声再生ボタン（大きく目立つデザイン）
   - 再生回数表示（あと2回聞けます等）
   - 選択肢（4つ）
   - 音量スライダー

4. **解説画面**
   - 正誤表示（⭕/❌）
   - 正解の音をもう一度再生するボタン
   - 音の説明文（楽器の特徴、音の由来等）
   - 次の問題ボタン

5. **結果画面**
   - スコア表示（10問中8問正解！）
   - 正答率（80%）
   - カテゴリー別正答率
   - もう一度挑戦ボタン
   - ホームに戻るボタン

6. **学習モード**（音源ライブラリ）
   - カテゴリー別タブ
   - 音源リスト（名前・アイコン）
   - 各音源に再生ボタン
   - 説明文表示

## 10. スケジュール・優先度

### Phase 1（MVP）
- クイズ出題・回答・採点機能
- 50音のプリセット音源作成/収集
- 音声再生機能
- スコア表示

### Phase 2（拡張）
- 学習モード（音源ライブラリ）
- 難易度設定
- 進捗管理

### Phase 3（改善）
- タイマー機能
- UI/UXブラッシュアップ
- 音質改善

## 11. 音源カテゴリー（初期案）

### 1. **楽器の音**（15音）
- ピアノ、ギター、バイオリン、トランペット、フルート、ドラム、ベース、サックス、ハープ、オルガン等

### 2. **動物の鳴き声**（12音）
- 犬、猫、牛、馬、鳥（スズメ、カラス、フクロウ）、ライオン、象、カエル、セミ等

### 3. **日常の音**（10音）
- ドアベル、車のクラクション、電話の着信音、掃除機、洗濯機、時計の秒針、キーボードタイピング、水道の蛇口、ドアの開閉等

### 4. **自然の音**（8音）
- 雨、雷、風、波、川のせせらぎ、鳥のさえずり、焚き火等

### 5. **効果音**（5音）
- 拍手、足音、ガラスが割れる音、ドアをノックする音、笑い声等

## 12. データ構造（初期案）

```json
{
  "sounds": [
    {
      "id": "s001",
      "category": "楽器の音",
      "name": "ピアノ",
      "filename": "piano.mp3",
      "description": "鍵盤楽器の代表格。ハンマーで弦を叩いて音を出します。",
      "difficulty": "初級"
    },
    {
      "id": "s002",
      "category": "動物の鳴き声",
      "name": "猫",
      "filename": "cat.mp3",
      "description": "猫の鳴き声。「ニャー」という特徴的な音。",
      "difficulty": "初級"
    }
  ],
  "userProgress": {
    "totalQuizzes": 5,
    "totalCorrect": 42,
    "totalQuestions": 50,
    "categoryStats": {
      "楽器の音": {"correct": 12, "total": 15},
      "動物の鳴き声": {"correct": 10, "total": 12}
    }
  }
}
```

## 13. 音源収集方針

### 著作権フリー音源サイト
- **Freesound.org**: 効果音・環境音
- **SoundBible.com**: 日常音・動物の鳴き声
- **DOVA-SYNDROME**: 日本の著作権フリー音源
- **効果音ラボ**: 日本語の効果音サイト

### 自作音源
- 楽器演奏を録音
- 日常音を録音
- 合成音（Web Audio APIで生成）

### 音質基準
- サンプリングレート: 44.1kHz以上
- ビットレート: 128kbps以上（MP3）
- モノラル/ステレオ: どちらでも可
- ノイズ除去処理済み

## 14. アクセシビリティ配慮

- **視覚障害者対応**
  - 音声ガイダンス（問題番号、選択肢の読み上げ）
  - キーボード操作対応

- **聴覚過敏者対応**
  - 音量調整機能
  - 音量上限設定

- **学習障害対応**
  - ルビ振り（漢字）
  - 分かりやすい言葉での解説
